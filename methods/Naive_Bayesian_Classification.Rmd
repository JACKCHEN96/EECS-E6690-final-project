---
title: "NaiveBayesianClassification"
author: "hz2619"
date: "12/8/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

## import xlsx and make label
```{r}
library(readxl)
data1 <- read_xlsx("../data/1415CSM_dataset.xlsx")
i=1
asLabel=""
for (val in data1$Ratings) {
  if(val<=4.9){
    asLabel[i]="Poor"
  }else if(val<=6.4){
    asLabel[i]="Average"
  }else if(val<=8.9){
    asLabel[i]="Good"
  }else if(val<=10){
    asLabel[i]="Excellent"
  }
  i=i+1
}
data1 = data.frame(data1,asLabel)
data1 
```

## split the whole dataset into train and test dataset (80% : 20%)
```{r}
set.seed(10) ## Randomize set.seed to 10
data1 = data.frame(data1,asLabel)
datasize = dim(data1)[1]
train_idx = sample(datasize, datasize*0.8)
indicator1 = rep(0,datasize)
indicator1[train_idx] = 1 ## 1:train 0:valid
data1 = data.frame(data1,indicator1)
train = subset(data1,data1$indicator1==1)
test = subset(data1,data1$indicator1==0)
```

## Brief about Train and Test Dataset
```{r}
summary(train)
summary(test)
```
```{r}
library(caret)
library(e1071)
NBclassfier = naiveBayes(asLabel ~ Genre+Gross+Budget+Screens+Sequel+Sentiment+Views+Likes+Dislikes+Comments+Aggregate.Followers, data = train)
print(NBclassfier)
predict(NBclassfier, newdata = train)
summary(predict(NBclassfier, newdata = train))
```
```{r}
library(naivebayes)
library(ggplot2)

printALL=function(model){
  trainPred=predict(model, newdata = train, type = "class")
  trainTable=table(train$asLabel, trainPred)
  testPred=predict(NBclassfier, newdata=test, type="class")
  testTable=table(test$asLabel, testPred)
  trainAcc=(trainTable[1,1]+trainTable[2,2]+trainTable[3,3])/sum(trainTable)
  testAcc=(testTable[1,1]+testTable[2,2]+testTable[3,3])/sum(testTable)
  message("Contingency Table for Training Data")
  print(trainTable)
  message("Contingency Table for Test Data")
  print(testTable)
  message("Accuracy")
  print(round(cbind(trainAccuracy=trainAcc, testAccuracy=testAcc),3))
}

newNBclassifier=naive_bayes(asLabel ~ Genre+Gross+Budget+Screens+Sequel+Sentiment+Views+Likes+Dislikes+Comments+Aggregate.Followers,usekernel=T, data=train)
printALL(newNBclassifier)
```
## Confusion Matrix of Train dataset
```{r}
library(dplyr)
library(tidyr)
library(ggplot2)
library(scales)
library(reshape2)

NB_train_predict <- predict(NBclassfier, newdata = train)
NB_test_predict  <- predict(NBclassfier, newdata = test)
cfm_train <- confusionMatrix(NB_train_predict,train$asLabel)
cfm_test  <- confusionMatrix(NB_test_predict,test$asLabel)
input.mat.train = as.matrix(cfm_train)
normalized.mat.train = sweep(input.mat.train, 2, colSums(input.mat.train), "/" )
melt.mat.train <- melt(normalized.mat.train)
ggplot(data = melt.mat.train, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile() + ggtitle("Train DatasetConfusion Matrix of NaiveBayesian") +
  xlab("Prediction") + ylab("Actual") + labs(fill = "frequency")
cfm_train
```
## Confusion Matrix of Test dataset
```{r}
input.mat.test = as.matrix(cfm_test)
normalized.mat.test = sweep(input.mat.test, 2, colSums(input.mat.test), "/" )
melt.mat.test <- melt(normalized.mat.test)
ggplot(data = melt.mat.test, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile() + ggtitle("Test Dataset Confusion Matrix of NaiveBayesian") +
  xlab("Prediction") + ylab("Actual") + labs(fill = "frequency")
cfm_test
```


